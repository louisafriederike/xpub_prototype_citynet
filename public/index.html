<!doctype html>
<html>
    <head>
        <title>868mhz.net</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="style.css" rel="stylesheet">
        <script src="input.js"></script>
        <script src="p5.geolocation.js"></script>
        <!-- <script src="p5.js"></script> -->
        <script src='socket.io/socket.io.js'></script>
        <script src="audio.js"></script>

    </head>
    <body>
        <script>
            let lat, lon;
                if ('geolocation' in navigator) {
                console.log('geolocation available');
                navigator.geolocation.getCurrentPosition(async position => {
                    let lat, lon, weather, air;
                    try {
                        lat = position.coords.latitude;
                        lon = position.coords.longitude;
                        document.getElementById('latitude').textContent = lat.toFixed(2);
                        document.getElementById('longitude').textContent = lon.toFixed(2);
                        const api_url = `weather/${lat},${lon}`;
                        const response = await fetch(api_url);
                        const json = await response.json();
                        weather = json.weather.currently;
                        air = json.air_quality.results[0].measurements[0];
                        document.getElementById('summary').textContent = weather.summary;
                        document.getElementById('temp').textContent = weather.temperature;
                        document.getElementById('aq_parameter').textContent = air.parameter;
                        document.getElementById('aq_value').textContent = air.value;
                        document.getElementById('aq_units').textContent = air.unit;
                        document.getElementById('aq_date').textContent = air.lastUpdated;
                        } catch (error) {
                        console.error(error);
                        air = { value: -1 };
                        document.getElementById('aq_value').textContent = 'NO READING';
                        }

                        const data = { lat, lon, weather, air };
                        const options = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                        };
                        const db_response = await fetch('/api', options);
                        const db_json = await db_response.json();
                        console.log(db_json);
                    });
                    } else {
                    console.log('geolocation not available');
                    }            
        </script>

        <div class="flex-container">
                    <div class="flex-left">
                        <div class="section">
                        
                        <p>>>> PORT:</p>
                        <span><form id="form" action="">
                            <input id="input" autocomplete="off"/><button>>>></button>
                        </form></span> 
                        <script>
                            var socket = io();
                            socket.on('data', function(data){
            
                                console.log(data);
            
                                document.getElementById('sample').style.opacity = data+"%"; 
            
                            });
            
                            socket.on('node1', function(sensor){
                    
                            console.log(sensor);
                            });	
            
                            var form = document.getElementById('form');
                            var input = document.getElementById('input');
            
                            form.addEventListener('submit', function(e) {
                                e.preventDefault();
                                if (input.value) {
                                socket.emit('chat message', input.value);
                                input.value = '';
                                }

                                if (input.value = '59687'){
                                    $("#objective").text("This dream was unlike any I can recall. It felt so real, yet so distorted and disorientating at the same time. I felt  the different textures of the ground pressing against the soles of my feet. An overwhelming feeling of presence rushing through my system. Present within my own body, I experience myself from a distance, hovering over me. This dream was different and it kept recurring more and more frequently. When I squint my eyes now, looking at the street lights, I can almost see it again. At first, I did not realise you were here, watching me. But of course, there was a reason this dream was unlike any other. ");
                                    playTrack1();
                                    localStorage.setItem('gateway','1');
                                    console.log(localStorage.getItem('gateway'));
                                    console.log("code is right");
                                    input.value = '';

                                }
                                
                                if (input.value = '00002'){
                                    $("#objective").text("log 2");
                                    playTrack1();
                                    localStorage.setItem('gateway','2');
                                    console.log(localStorage.getItem('gateway'));
                                    console.log("code is right");
                                    input.value = '';

                                }
                                // else{
                                //     $("#objective").text("connecting failed, inactive port. Enter correct port number to connect.");

                                // }
                            }); 
                        </script>
                        </div>
                        <div class="section" id="objective">
                        <p>OBJECTIVE:<br>Enter S/ash Gallery to step into the game.</p>  
                        </div>
                       
                        <div class="section">
                            <p>DISTANCE: <span id="distance">0</span> km</p>
                      
                            <div id="tripmeter">
                                <!-- <p>Gateway 1:<br/>
                                    <span id="startLat">???</span>&deg; <br><span id="startLon">???</span>&deg;
                                </p>
                                <p>Gateway 2:<br/>
                                    <span id="startLat2">???</span>&deg; <br><span id="startLon2">???</span>&deg;
                                </p>
                                <p>
                                    Status:<br/>
                                    <span id="message2">detecting....</span>
                                    </p>
                                <p>
                                    Current Location:<br/>
                                    <span id="currentLat">locating...</span>&deg; <br><span id="currentLon">locating...</span>&deg;
                                </p> --> 
                                    <p>
                                    STATUS:
                                    <span id="message">detecting....</span>
                                    </p>                               
                                </div>
                        </div>

                        <div class="section" id="log">
                         <p>log 1           03:00:00         13-05-22<br></p>
                         <p> log 2           03:00:00         13-05-22<br></p>
                            <p>  log 2           03:00:00         13-05-22<br></p>
                                <p>   log 3           03:00:00         13-05-22<br></p>
                                    <p>   log 4           03:00:00         13-05-22<br></p>
                                        <p>   log 5           03:00:00         13-05-22<br></p>
                                            <p>   log 6           03:00:00         13-05-22<br></p>
                        </div>
                        <div class="section" id="back" onclick="backAgain()">
                           back
                            </div>
                        <div class="section" id="zoommap">
                        </div>
                    </div>
                       

            
            <div class="flex-right">
                <div class="section">
                <p onclick="showLog()">LOG</p>
                </div>
                    <!-- <input id="icon" width="20%" class="on-location-track" type="image" src="img/868.png"  onclick="playMusic()" style="visibility: hidden; z-index: 2"/>
                    <input id="icon" width="22%" class="nav-track" type="image" src="img/868.png"  onclick="playMusic1()" style="visibility: visible;"/>  -->
                <div class="section" id="dreammap">
                   <p onclick="openMap()"> MAP:</p>
                   <p onclick="closeMap()"> minimize</p>
                    <!-- <img id="map" src="img/abstract_map.png" alt="map" usemap="#workmap" width="70%">     
                    <map name="workmap">
                    <area shape="circle" coords="337, 300, 44" alt="Computer" onclick="playMusic()"  href="#">
                    </map> -->
                    
                    <img src="img/map-markers.png" alt="map" usemap="#map" >

                    <map name="map">
                      <area shape="circle" coords="45,45,15" alt="node01" onclick="breadCrumb1()" href="#">
                      <area shape="circle" coords="20, 85,15" alt="node01" onclick="breadCrumb1()" href="#">
                      <area shape="circle" coords="80,110,15" alt="node01" onclick="breadCrumb2()" href="#">
                      <area shape="circle" coords="115,100,15" alt="node01" onclick="breadCrumb3()" href="#">     
                      <area shape="circle" coords="20,130,15" alt="node01" onclick="breadCrumb4()" href="#">
                      <area shape="circle" coords="65,190,15" alt="node01" onclick="breadCrumb5()" href="#">
                      <area shape="circle" coords="120,160,15" alt="node01" onclick="breadCrumb6()" href="#">
                      <area shape="circle" coords="145,185,15" alt="node01" onclick="breadCrumb7()" href="#">
                      <area shape="circle" coords="210,115,15" alt="node01" onclick="breadCrumb8()" href="#">
                      <area shape="circle" coords="125,125,15" alt="node01" onclick="breadCrumb9()" href="#">
                      <area shape="circle" coords="120,40,15" alt="node01" onclick="breadCrumb10()" href="#">
                      <area shape="circle" coords="180,30,15" alt="node01" onclick="breadCrumb11()" href="#">
                    </map> 
                   

                    <script>
                        alert("⇶ turn phone horizonally ⇶  use mobile data ⇶ turn sound on ⇶  allow location access ⇶ don't attract attention ⇶ bon vovage ⇶ ");
                        zoommap = document.querySelector('#zoommap');
                        log = document.querySelector('#log');
                        back = document.querySelector('#back');

                        function openMap(){
                            
                            $("#dreammap").toggleClass("zoom");

                            // if (zoommap.style.visibility = "hidden"){
                            //     zoommap.style.visibility = "visible";
                            // }
                        }

                        function closeMap(){                          
                            // if (zoommap.style.visibility = "visible"){
                            //     zoommap.style.visibility = "hidden";
                            // }                         
                        }

                        function showLog(){                          
                           log.style.visibility = "visible";
                           back.style.visibility = "visible";
                           $("#log").text("log 1   222  33");
                         
                        }

                        function showHelp(){                          
                           log.style.visibility = "visible";
                           $("#log").text("Locate the closest module by clicking on the landmarks on the map and moving accordingly. When set to the correct frequency, the module will reveal the local port code after a few seconds. The shape of the map is abstract and should not be solely used for navigation.");
                           back.style.visibility = "visible";
                        }

                        function showAbout(){  
                            log.style.visibility = "visible";                        
                            $("#log").text("868 MHz is a hybrid reality game running on the same standardized frequency as the LoRa gateways of The Things Network. Chase the electric currents of the asphalt to locate gateways and encounter a being which has nested itself beneath the city streets, all the way down the power lines woven amidst its whirring epicenter. Early release for Tec Art 2022, in progress master graduation work by Experimental Publishing student Louisa Teichmann. Module cases designed and 3D printed by Roos Groothuizen. Sound design by Kevin Stam. Logo design by Camilo García A. Realised in support by Planetart, TETEM, Joseph Knierzinger, Michael Murthaugh, Cristina Cochior and in inspiration and conversation with Mika Motskobili and with mental support by Micah Snijkers. Don't hate the game, hate the players. Just kidding, I hope you're finding your way ok.");
                            back.style.visibility = "visible";
                            
                        }

                        function backAgain(){  
                            log.style.visibility = "hidden";                        
                            back.style.visibility = "hidden";
                        }

                    </script>
                </div>
                <div class="section">
                   <p onclick="showHelp()">HELP</p>
                </div>
                <div class="section">
                       <p onclick="showAbout()">ABOUT</p>
                </div>
            </div>

        </div>  
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script type="text/javascript" src="fence.js"></script>
    
 
    </body>
</html>
