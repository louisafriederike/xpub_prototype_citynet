<!doctype html>
<html>
    <head>
        <title>Communicazion</title>
        <link href="style.css" rel="stylesheet">
        <script src="p5.geolocation.js"></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js'></script>

        <script>
            let lat, lon;
            if ('geolocation' in navigator) {
            console.log('geolocation available');
            navigator.geolocation.getCurrentPosition(async position => {
                let lat, lon, weather, air;
                try {
                lat = position.coords.latitude;
                lon = position.coords.longitude;
                document.getElementById('latitude').textContent = lat.toFixed(2);
                document.getElementById('longitude').textContent = lon.toFixed(2);
                const api_url = `weather/${lat},${lon}`;
                const response = await fetch(api_url);
                const json = await response.json();
                weather = json.weather.currently;
                air = json.air_quality.results[0].measurements[0];
                document.getElementById('summary').textContent = weather.summary;
                document.getElementById('temp').textContent = weather.temperature;
                document.getElementById('aq_parameter').textContent = air.parameter;
                document.getElementById('aq_value').textContent = air.value;
                document.getElementById('aq_units').textContent = air.unit;
                document.getElementById('aq_date').textContent = air.lastUpdated;
                } catch (error) {
                console.error(error);
                air = { value: -1 };
                document.getElementById('aq_value').textContent = 'NO READING';
                }
    
                const data = { lat, lon, weather, air };
                const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
                };
                const db_response = await fetch('/api', options);
                const db_json = await db_response.json();
                console.log(db_json);
            });
            } else {
            console.log('geolocation not available');
            }
        </script>
        <style>
        
            #sample {
                background-color: blue;
                width: 100px;
                height: 10px;
            }
        
        </style>
        
    </head>
    <body>
        <p>
            Your location is <span id="latitude"></span>&deg;,
            <span id="longitude"></span>&deg;<span id="summary"></span>.
        </p>
        <div id="sample"></div>
        <button onclick='socket.emit("hello"); '>Hello Server</button> 

        <script>

            var socket = io();
            socket.on('data', function(data){

                console.log(data);

                document.getElementById('sample').style.opacity = data+"%"; 

            });

         </script>
         <section id="home">
            <h2>Identity Verification</h2>
            <p>please verify identity below.</p>
            <p><span>Type 'help' + <kbd>Enter</kbd> -- for available commands.</span></p>
            </section>
            
            <section id="pigeon">
            <h2><span>&raquo;verification successful</span></h2>
            <p>welcome back, ella.</p><br>
            <p>Uh Ah CHA CHA CHA, 10 steps to the left, AH AH turn left, 9 steps to the left UH UH my favourite hat.</p></section>
            </section>
            
            <section id="usage">
            <h2><span>&raquo;Usage</span></h2>
            <p>Use me.</p>
            </section>
            
            <section id="download">
            <h2><span>&raquo;Download</span></h2>
            <p>You wouldn't download a house.</p>
            </section>
            
            <section id="error">
            <p>Command not found!<p> 
            <p><span>Type 'help' + <kbd>Enter</kbd> -- for available commands.</span></p>
            </section>
            
            <section id="help">
            <h2><span>&raquo;Help?</span></h2>
            <p><span>Type [command] + <kbd>Enter</kbd></span>lingering in a mirror world was the truth to a puzzle which was not meant to be solved.</p>
            <ul>
                <li>'home' -- Thats obvious!</li>
                <li>'about' -- What's this for</li>
                <li>'help' -- displays this list</li>
            </ul>
            </section>
            
            <span class="command">wiredworld:/$<input type="text"></span>
            </main>
            
            
            <script src="chat.js"></script>
            </body>
    </body>
</html>